<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š å½©ç¥¨å®æ—¶çœ‹æ¿ - å¤šäººå®æ—¶åŒæ­¥</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    <style>
        /* äº‘çŠ¶æ€æ˜¾ç¤º */
        .cloud-status {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: #2c3e50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cloud-status.online {
            background: #27ae60;
        }

        .cloud-status.offline {
            background: #e74c3c;
        }

        .cloud-status.connecting {
            background: #f39c12;
        }

        /* å¯†ç éªŒè¯é¡µé¢æ ·å¼ */
        #passwordOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
        .login-box h1 { color: #2c3e50; margin-bottom: 30px; }
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: bold;
        }
        #passwordInput {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border 0.3s;
        }
        #passwordInput:focus {
            outline: none;
            border-color: #3498db;
        }
        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        .password-error {
            color: #e74c3c;
            margin-top: 10px;
            min-height: 20px;
            font-size: 14px;
        }
        .password-hint {
            color: #7f8c8d;
            font-size: 12px;
            margin-top: 20px;
            text-align: center;
        }

        /* ä¸»çœ‹æ¿æ ·å¼ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft YaHei', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container { 
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header { 
            background: linear-gradient(to right, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .status-bar {
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 3px solid #27ae60;
        }

        /* å†å²è®°å½•å¼¹çª—æ ·å¼ */
        .history-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            display: none;
        }

        .history-modal-header {
            background: linear-gradient(to right, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-modal-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-history-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .close-history-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .history-modal-content {
            padding: 20px;
            overflow-y: auto;
            max-height: 60vh;
        }

        .history-actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 0 0 15px 15px;
            border-top: 1px solid #eee;
        }

        .history-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .history-btn:hover {
            background: #f5f5f5;
        }

        .history-count {
            font-size: 14px;
            color: #7f8c8d;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 12px 40px 12px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            font-size: 13px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .delete-btn {
            position: absolute;
            right: 10px;
            top: 12px;
            background: #ffebee;
            color: #e74c3c;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: #ffcdd2;
            transform: scale(1.1);
        }

        .history-time {
            color: #3498db;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .history-text {
            font-size: 14px;
            margin: 5px 0;
            color: #333;
            line-height: 1.5;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .history-stats {
            display: flex;
            gap: 10px;
            margin: 5px 0;
            font-size: 11px;
            color: #7f8c8d;
        }

        .history-stat-item {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .history-amount {
            color: #e74c3c;
            font-weight: bold;
            text-align: right;
            font-size: 16px;
            margin-top: 5px;
        }

        /* æ€»è®¡é‡‘é¢å’Œæ¸…ç©ºæŒ‰é’® */
        .total-section {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .total-box {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            flex: 1;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.2);
        }

        .clear-all-btn {
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.2);
            transition: all 0.3s ease;
        }

        .clear-all-btn:hover {
            background: #34495e;
            transform: translateY(-2px);
        }

        /* ç®€åŒ–ç²˜è´´æ¡† */
        .input-section {
            padding: 20px;
            background: white;
            border-bottom: 1px solid #eee;
        }

        .paste-label {
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            font-size: 16px;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            resize: none;
            background: #f8f9fa;
            font-family: 'Microsoft YaHei', monospace;
        }

        textarea:focus {
            outline: none;
            border-color: #3498db;
            background: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
        }

        .btn-history {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
        }

        .data-section {
            padding: 15px;
            background: white;
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* è¡¨æ ¼æ ·å¼ - ä¸æ»‘åŠ¨ï¼Œéšé¡µé¢æ»šåŠ¨ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            font-size: 16px;
        }

        .data-table th {
            background: #34495e;
            color: white;
            padding: 16px 10px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .data-table td {
            padding: 14px 10px;
            border-bottom: 2px solid #eee;
            text-align: center;
            font-size: 16px;
        }

        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .data-table tr:hover {
            background: #f0f7ff;
        }

        /* å¢å¤§å·ç å­—ä½“åˆ°20px */
        .number-cell {
            font-weight: bold;
            color: #2c3e50;
            font-family: Arial, sans-serif;
            font-size: 20px;
        }

        .zodiac-cell {
            color: #2c3e50;
            font-weight: bold;
            font-size: 18px;
        }

        .wave-cell {
            font-weight: bold;
            padding: 6px 12px;
            border-radius: 6px;
            display: inline-block;
            font-size: 16px;
        }

        .wave-red {
            background: #ffebee;
            color: #e74c3c;
        }

        .wave-blue {
            background: #e3f2fd;
            color: #3498db;
        }

        .wave-green {
            background: #e8f5e9;
            color: #27ae60;
        }

        .amount-cell {
            font-weight: bold;
            color: #e74c3c;
            font-size: 18px;
        }

        .amount-cell-zero {
            font-weight: normal;
            color: #95a5a6;
        }
    </style>
</head>
<body>
    <!-- å¯†ç éªŒè¯é¡µé¢ -->
    <div id="passwordOverlay">
        <div class="login-box">
            <h1>ğŸ” å½©ç¥¨çœ‹æ¿éªŒè¯</h1>
            <div class="input-group">
                <label for="passwordInput">è¯·è¾“å…¥è®¿é—®å¯†ç </label>
                <input type="password" id="passwordInput" placeholder="è¾“å…¥å¯†ç åæŒ‰Enterç¡®è®¤">
            </div>
            <div id="passwordError" class="password-error"></div>
            <button id="loginBtn" class="login-btn">è¿›å…¥çœ‹æ¿ç³»ç»Ÿ</button>
            <div class="password-hint">é¦–æ¬¡ä½¿ç”¨è¯·è”ç³»ç®¡ç†å‘˜è·å–å¯†ç </div>
        </div>
    </div>

    <!-- ä¸»çœ‹æ¿å®¹å™¨ -->
    <div id="mainBoard" style="display: none;">
        <div class="container">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="header">
                <h1>ğŸ“Š å½©ç¥¨å®æ—¶çœ‹æ¿</h1>
                <p>å¤šäººå®æ—¶åŒæ­¥ â€¢ æ•°æ®è‡ªåŠ¨ä¿å­˜</p>
            </div>

            <div class="status-bar" id="statusBar">
                ğŸ”„ æ­£åœ¨è¿æ¥äº‘ç«¯...
            </div>

            <!-- æ€»è®¡é‡‘é¢å’Œæ¸…ç©ºæŒ‰é’® -->
            <div class="total-section">
                <div class="total-box">
                    ğŸ’° æ€»è®¡: <span id="totalAmount">0</span> å…ƒ
                </div>
                <button id="clearAllBtn" class="clear-all-btn">
                    ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨
                </button>
            </div>

            <!-- ç²˜è´´è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <label class="paste-label">ğŸ“‹ ç²˜è´´å½©ç¥¨æ•°æ® (æ¯è¡Œä¸€æ¡)</label>
                <textarea id="lotteryInput" placeholder="ç¤ºä¾‹ï¼š
123ã€å„å·100å…ƒ
456 æ¯é¢— 50
789å„25
..."></textarea>
                <div class="btn-group">
                    <button id="parseBtn" class="btn btn-primary">
                        ğŸ“Š è§£ææ•°æ®
                    </button>
                    <button id="clearBtn" class="btn">
                        ğŸ§¹ æ¸…ç©ºè¾“å…¥
                    </button>
                    <button id="showHistoryBtn" class="btn btn-history">
                        ğŸ“œ å†å²è®°å½•
                    </button>
                </div>
            </div>

            <!-- æ•°æ®æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="data-section">
                <h3 class="section-title">ğŸ“ˆ å½“å‰æ•°æ® (<span id="dataCount">0</span> æ¡)</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å·ç </th>
                            <th>ç”Ÿè‚–</th>
                            <th>æ³¢è‰²</th>
                            <th>é‡‘é¢</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- æ•°æ®å°†é€šè¿‡JSåŠ¨æ€æ’å…¥ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- å†å²è®°å½•å¼¹çª— -->
        <div id="historyModal" class="history-modal">
            <div class="history-modal-header">
                <h2>ğŸ“œ å†å²è®°å½•</h2>
                <button id="closeHistoryBtn" class="close-history-btn">Ã—</button>
            </div>
            <div class="history-modal-content">
                <div id="historyList" class="history-list">
                    <!-- å†å²è®°å½•å°†é€šè¿‡JSåŠ¨æ€æ’å…¥ -->
                </div>
            </div>
            <div class="history-actions-bar">
                <div class="history-count">
                    å…± <span id="historyCount">0</span> æ¡è®°å½•
                </div>
                <button id="exportHistoryBtn" class="history-btn">
                    ğŸ“¥ å¯¼å‡ºè®°å½•
                </button>
            </div>
        </div>

        <!-- äº‘ç«¯çŠ¶æ€æ˜¾ç¤º -->
        <div id="cloudStatus" class="cloud-status connecting">
            <span>â˜ï¸ è¿æ¥ä¸­...</span>
        </div>
    </div>

    <script>
        // ç³»ç»Ÿé…ç½®
        const CONFIG = {
            PASSWORD: '888888', // é»˜è®¤å¯†ç 
            CLOUD_SYNC: true,
            MAX_HISTORY: 1000
        };

        // ç³»ç»ŸçŠ¶æ€
        let currentData = [];
        let historyData = [];
        let isOnline = false;

        // DOMå…ƒç´ å¼•ç”¨
        const passwordOverlay = document.getElementById('passwordOverlay');
        const mainBoard = document.getElementById('mainBoard');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const passwordError = document.getElementById('passwordError');
        const lotteryInput = document.getElementById('lotteryInput');
        const parseBtn = document.getElementById('parseBtn');
        const clearBtn = document.getElementById('clearBtn');
        const showHistoryBtn = document.getElementById('showHistoryBtn');
        const dataTableBody = document.getElementById('dataTableBody');
        const dataCount = document.getElementById('dataCount');
        const totalAmount = document.getElementById('totalAmount');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const historyModal = document.getElementById('historyModal');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const historyList = document.getElementById('historyList');
        const historyCount = document.getElementById('historyCount');
        const exportHistoryBtn = document.getElementById('exportHistoryBtn');
        const cloudStatus = document.getElementById('cloudStatus');
        const statusBar = document.getElementById('statusBar');

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¯†ç éªŒè¯ç›¸å…³
            passwordInput.focus();
            
            loginBtn.addEventListener('click', verifyPassword);
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') verifyPassword();
            });

            // ä¸»åŠŸèƒ½æŒ‰é’®
            parseBtn.addEventListener('click', parseAndAddData);
            clearBtn.addEventListener('click', function() {
                lotteryInput.value = '';
                lotteryInput.focus();
            });
            clearAllBtn.addEventListener('click', clearAllData);
            
            // å†å²è®°å½•ç›¸å…³
            showHistoryBtn.addEventListener('click', showHistory);
            closeHistoryBtn.addEventListener('click', closeHistory);
            exportHistoryBtn.addEventListener('click', exportHistory);
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            historyModal.addEventListener('click', function(e) {
                if (e.target === historyModal) closeHistory();
            });

            // åŠ è½½å†å²æ•°æ®
            loadHistoryData();
            
            // åˆå§‹åŒ–äº‘ç«¯çŠ¶æ€
            updateCloudStatus();
        });

        // å¯†ç éªŒè¯å‡½æ•°
        function verifyPassword() {
            const input = passwordInput.value.trim();
            
            if (input === CONFIG.PASSWORD) {
                passwordOverlay.style.display = 'none';
                mainBoard.style.display = 'block';
                
                // åˆå§‹åŒ–æ•°æ®è¡¨æ ¼
                updateDataTable();
                
                // æ¨¡æ‹Ÿäº‘ç«¯è¿æ¥
                setTimeout(() => {
                    updateCloudStatus('online');
                }, 1000);
                
            } else {
                passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // ==================== æ ¸å¿ƒå‡½æ•°ï¼šparseInput ====================
        function parseInput(input) {
            const results = [];
            if (!input.trim()) return results;
            
            // ç”Ÿè‚–æ˜ å°„
            const zodiacMap = {
                "é¼ ": [6, 18, 30, 42], "ç‰›": [5, 17, 29, 41], "è™": [4, 16, 28, 40],
                "å…”": [3, 15, 27, 39], "é¾™": [2, 14, 26, 38], "è›‡": [1, 13, 25, 37, 49],
                "é©¬": [12, 24, 36, 48], "ç¾Š": [11, 23, 35, 47], "çŒ´": [10, 22, 34, 46],
                "é¸¡": [9, 21, 33, 45], "ç‹—": [8, 20, 32, 44], "çŒª": [7, 19, 31, 43]
            };
            
            console.log('å¼€å§‹è§£æè¾“å…¥...');
            
            // æŒ‰é€—å·åˆ†å‰²ä¸åŒçš„æŠ•æ³¨é¡¹
            const entries = input.split(/[ï¼Œ,]/).map(e => e.trim()).filter(e => e);
            
            entries.forEach(entry => {
                // åŒ¹é…æ ¼å¼ï¼šå†…å®¹ å„å· é‡‘é¢ å…ƒ
                const match = entry.match(/(.+?)(?:å„|å„å·|æ¯å·|æ¯é¢—|æ¯)\s*(\d+(?:\.\d+)?)\s*(?:å…ƒ|æ–¤|ç±³|å—|$)/);
                if (!match) return;
                
                const [, content, amountStr] = match;
                const amount = parseFloat(amountStr);
                if (isNaN(amount) || amount <= 0) return;
                
                // æ¸…ç†å†…å®¹ï¼šç§»é™¤æ‰€æœ‰ç©ºæ ¼
                const cleanContent = content.replace(/\s+/g, '');
                
                // æŒ‰åˆ†éš”ç¬¦åˆ†å‰²é¡¹ç›®
                const items = cleanContent.split(/[\.ã€]/).filter(item => item.trim());
                
                items.forEach(item => {
                    const cleanItem = item.trim();
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç”Ÿè‚–
                    if (zodiacMap[cleanItem]) {
                        // æ˜¯ç”Ÿè‚–ï¼šæ‰€æœ‰å¯¹åº”å·ç éƒ½åŠ é’±
                        zodiacMap[cleanItem].forEach(num => {
                            results.push({
                                numbers: [num],
                                description: cleanItem,
                                amount: amount,
                                zodiac: cleanItem,
                                wave: calculateWaveColor([num]),
                                timestamp: new Date().toLocaleTimeString()
                            });
                        });
                    } 
                    // æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—
                    else if (/^\d+$/.test(cleanItem)) {
                        const num = parseInt(cleanItem.replace(/^0+/, '')) || parseInt(cleanItem);
                        if (num >= 1 && num <= 49) {
                            results.push({
                                numbers: [num],
                                description: '',
                                amount: amount,
                                zodiac: calculateZodiac([num]),
                                wave: calculateWaveColor([num]),
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    }
                });
            });
            
            console.log('è§£æå®Œæˆï¼Œæ‰¾åˆ°', results.length, 'ä¸ªå·ç ');
            return results;
        }

        // è§£æå¹¶æ·»åŠ æ•°æ®
        function parseAndAddData() {
            const input = lotteryInput.value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥æ•°æ®');
                return;
            }

            const parsedData = parseInput(input);
            
            if (parsedData.length === 0) {
                alert('æœªè¯†åˆ«åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥æ ¼å¼');
                return;
            }

            // æ·»åŠ åˆ°å½“å‰æ•°æ®
            currentData = currentData.concat(parsedData);
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            parsedData.forEach(item => {
                historyData.unshift({
                    ...item,
                    id: Date.now() + Math.random(),
                    fullText: input
                });
            });

            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (historyData.length > CONFIG.MAX_HISTORY) {
                historyData = historyData.slice(0, CONFIG.MAX_HISTORY);
            }

            // æ›´æ–°ç•Œé¢
            updateDataTable();
            updateTotalAmount();
            saveHistoryData();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            lotteryInput.value = '';
            lotteryInput.focus();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showNotification(`æˆåŠŸæ·»åŠ  ${parsedData.length} æ¡æ•°æ®`);
        }

        // ç”Ÿè‚–è®¡ç®—å‡½æ•°
        function calculateZodiac(numbers) {
            const zodiacMap = {
                1: 'è›‡', 13: 'è›‡', 25: 'è›‡', 37: 'è›‡', 49: 'è›‡',
                2: 'é¾™', 14: 'é¾™', 26: 'é¾™', 38: 'é¾™',
                3: 'å…”', 15: 'å…”', 27: 'å…”', 39: 'å…”',
                4: 'è™', 16: 'è™', 28: 'è™', 40: 'è™',
                5: 'ç‰›', 17: 'ç‰›', 29: 'ç‰›', 41: 'ç‰›',
                6: 'é¼ ', 18: 'é¼ ', 30: 'é¼ ', 42: 'é¼ ',
                7: 'çŒª', 19: 'çŒª', 31: 'çŒª', 43: 'çŒª',
                8: 'ç‹—', 20: 'ç‹—', 32: 'ç‹—', 44: 'ç‹—',
                9: 'é¸¡', 21: 'é¸¡', 33: 'é¸¡', 45: 'é¸¡',
                10: 'çŒ´', 22: 'çŒ´', 34: 'çŒ´', 46: 'çŒ´',
                11: 'ç¾Š', 23: 'ç¾Š', 35: 'ç¾Š', 47: 'ç¾Š',
                12: 'é©¬', 24: 'é©¬', 36: 'é©¬', 48: 'é©¬'
            };
            
            if (numbers && numbers.length > 0) {
                return zodiacMap[numbers[0]] || 'æœªçŸ¥';
            }
            return 'æœªçŸ¥';
        }

        // æ³¢è‰²è®¡ç®—å‡½æ•°
        function calculateWaveColor(numbers) {
            const redWave = [1, 2, 7, 8, 12,13,18,19,23,24,29,30,34,35,40,45,46];
            const blueWave = [3, 4, 9,10,14,15,20,25,26,31,36,37,41,42,47,48];
            const greenWave = [5, 6,11,16,17,21,22,27,28,32,33,38,39,43,44,49];
            
            if (numbers && numbers.length > 0) {
                const num = numbers[0];
                if (redWave.includes(num)) return 'çº¢æ³¢';
                if (blueWave.includes(num)) return 'è“æ³¢';
                if (greenWave.includes(num)) return 'ç»¿æ³¢';
            }
            return 'æœªçŸ¥';
        }

        // æ›´æ–°æ•°æ®è¡¨æ ¼
        function updateDataTable() {
            dataTableBody.innerHTML = '';
            dataCount.textContent = currentData.length;

            if (currentData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" style="text-align: center; color: #95a5a6; padding: 40px;">
                    ğŸ“ æš‚æ— æ•°æ®ï¼Œè¯·åœ¨ä¸Šæ–¹ç²˜è´´æ•°æ®
                </td>`;
                dataTableBody.appendChild(row);
                return;
            }

            currentData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                // æ ¼å¼åŒ–å·ç æ˜¾ç¤º
                const numbersHtml = item.numbers.map(num => 
                    `<span class="number-cell">${num}</span>`
                ).join(' ');
                
                // ç¡®å®šæ³¢è‰²CSSç±»
                let waveClass = 'wave-cell';
                if (item.wave.includes('çº¢')) waveClass += ' wave-red';
                else if (item.wave.includes('è“')) waveClass += ' wave-blue';
                else if (item.wave.includes('ç»¿')) waveClass += ' wave-green';
                
                // ç¡®å®šé‡‘é¢CSSç±»
                const amountClass = item.amount > 0 ? 'amount-cell' : 'amount-cell-zero';
                
                row.innerHTML = `
                    <td>${numbersHtml}</td>
                    <td class="zodiac-cell">${item.zodiac}</td>
                    <td><span class="${waveClass}">${item.wave}</span></td>
                    <td class="${amountClass}">${item.amount.toFixed(2)}</td>
                `;
                
                dataTableBody.appendChild(row);
            });
        }

        // æ›´æ–°æ€»é‡‘é¢
        function updateTotalAmount() {
            const total = currentData.reduce((sum, item) => sum + item.amount, 0);
            totalAmount.textContent = total.toFixed(2);
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (currentData.length === 0) return;
            
            if (confirm(`ç¡®å®šè¦æ¸…ç©ºå…¨éƒ¨ ${currentData.length} æ¡æ•°æ®å—ï¼Ÿ`)) {
                currentData = [];
                updateDataTable();
                updateTotalAmount();
                showNotification('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®');
            }
        }

        // åŠ è½½å†å²æ•°æ®
        function loadHistoryData() {
            try {
                const saved = localStorage.getItem('lottery_history');
                if (saved) {
                    historyData = JSON.parse(saved);
                }
            } catch (e) {
                console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', e);
                historyData = [];
            }
        }

        // ä¿å­˜å†å²æ•°æ®
        function saveHistoryData() {
            try {
                localStorage.setItem('lottery_history', JSON.stringify(historyData));
            } catch (e) {
                console.error('ä¿å­˜å†å²æ•°æ®å¤±è´¥:', e);
            }
        }

        // æ˜¾ç¤ºå†å²è®°å½•
        function showHistory() {
            historyList.innerHTML = '';
            historyCount.textContent = historyData.length;

            if (historyData.length === 0) {
                historyList.innerHTML = `
                    <div style="text-align: center; color: #95a5a6; padding: 40px;">
                        ğŸ“ æš‚æ— å†å²è®°å½•
                    </div>
                `;
            } else {
                historyData.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const numbersText = item.numbers.join('ã€');
                    
                    historyItem.innerHTML = `
                        <span class="history-time">${item.timestamp}</span>
                        <div class="history-text">${numbersText} ${item.description} ${item.amount.toFixed(2)}å…ƒ</div>
                        <div class="history-stats">
                            <span class="history-stat-item">ç”Ÿè‚–: ${item.zodiac}</span>
                            <span class="history-stat-item">æ³¢è‰²: ${item.wave}</span>
                        </div>
                        <div class="history-amount">${item.amount.toFixed(2)}å…ƒ</div>
                        <button class="delete-btn" onclick="deleteHistoryItem(${index})">Ã—</button>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
            }

            historyModal.style.display = 'block';
        }

        // åˆ é™¤å†å²è®°å½•é¡¹
        function deleteHistoryItem(index) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                historyData.splice(index, 1);
                saveHistoryData();
                showHistory();
                showNotification('å·²åˆ é™¤è®°å½•');
            }
        }

        // å…³é—­å†å²è®°å½•
        function closeHistory() {
            historyModal.style.display = 'none';
        }

        // å¯¼å‡ºå†å²è®°å½•
        function exportHistory() {
            if (historyData.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            let exportText = 'å½©ç¥¨å†å²è®°å½•\n';
            exportText += 'æ—¶é—´,å·ç ,æè¿°,é‡‘é¢,ç”Ÿè‚–,æ³¢è‰²\n';
            
            historyData.forEach(item => {
                const numbers = item.numbers.join('ã€');
                exportText += `${item.timestamp},${numbers},${item.description},${item.amount.toFixed(2)},${item.zodiac},${item.wave}\n`;
            });

            const blob = new Blob([exportText], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `å½©ç¥¨è®°å½•_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('å·²å¯¼å‡ºå†å²è®°å½•');
        }

        // æ›´æ–°äº‘ç«¯çŠ¶æ€
        function updateCloudStatus(status = 'connecting') {
            cloudStatus.className = `cloud-status ${status}`;
            
            switch(status) {
                case 'online':
                    cloudStatus.innerHTML = '<span>â˜ï¸ äº‘ç«¯å·²è¿æ¥</span>';
                    statusBar.textContent = 'âœ… æ•°æ®å®æ—¶åŒæ­¥ä¸­';
                    statusBar.style.background = '#2ecc71';
                    isOnline = true;
                    break;
                case 'offline':
                    cloudStatus.innerHTML = '<span>âš ï¸ äº‘ç«¯æ–­å¼€</span>';
                    statusBar.textContent = 'âš ï¸ ç¦»çº¿æ¨¡å¼ï¼ˆæ•°æ®æœ¬åœ°ä¿å­˜ï¼‰';
                    statusBar.style.background = '#e74c3c';
                    isOnline = false;
                    break;
                default:
                    cloudStatus.innerHTML = '<span>ğŸ”„ è¿æ¥ä¸­...</span>';
                    statusBar.textContent = 'ğŸ”„ æ­£åœ¨è¿æ¥äº‘ç«¯...';
                    statusBar.style.background = '#f39c12';
                    isOnline = false;
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            alert(message); // ç®€å•ç”¨alertä»£æ›¿
        }

        // ç²˜è´´æ¿åŠŸèƒ½æ”¯æŒ
        document.addEventListener('paste', function(e) {
            const activeElement = document.activeElement;
            
            // å¦‚æœç„¦ç‚¹åœ¨è¾“å…¥æ¡†ï¼Œä¸å¤„ç†
            if (activeElement && activeElement.tagName === 'TEXTAREA') {
                return;
            }
            
            // å¦‚æœç„¦ç‚¹åœ¨å¯†ç è¾“å…¥æ¡†ï¼Œä¸å¤„ç†
            if (activeElement && activeElement.id === 'passwordInput') {
                return;
            }
            
            // è·å–ç²˜è´´æ¿æ•°æ®
            const clipboardData = e.clipboardData || window.clipboardData;
            const pastedText = clipboardData.getData('text');
            
            if (pastedText.trim()) {
                // è‡ªåŠ¨å¡«å…¥è¾“å…¥æ¡†å¹¶è§£æ
                lotteryInput.value = pastedText;
                parseAndAddData();
                
                // é˜»æ­¢é»˜è®¤ç²˜è´´è¡Œä¸º
                e.preventDefault();
            }
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl + Enter è§£ææ•°æ®
            if (e.ctrlKey && e.key === 'Enter') {
                if (lotteryInput.value.trim()) {
                    parseAndAddData();
                }
            }
            
            // Ctrl + H æ˜¾ç¤ºå†å²è®°å½•
            if (e.ctrlKey && e.key === 'h') {
                e.preventDefault();
                showHistory();
            }
            
            // Esc å…³é—­å†å²è®°å½•
            if (e.key === 'Escape' && historyModal.style.display === 'block') {
                closeHistory();
            }
        });

        // ä½¿åˆ é™¤å‡½æ•°å…¨å±€å¯ç”¨
        window.deleteHistoryItem = deleteHistoryItem;
    </script>
</body>
</html>
